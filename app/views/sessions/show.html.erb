<h1>市場価値メーター（最小版）</h1>

<p>目標金額: ¥<%= @session.target_price %></p>
<p>達成までの時間: <%= @session.target_hours %> h</p>
<p>合計時間: <%= @session.live_hours.round(2) %> h（<%= @session.live_seconds %> 秒）</p>
<p>１時間で稼げる: ¥<%= @session.hour_price.round %>/h</p>
<p>現在の市場価値: ¥<%= @session.now_price.round %></p>

<% if notice.present? %>
  <p class="notice"><%= notice %></p>
<% end %>

<h2>目標の入力</h2>


<%= form_with model: @session, url: update_target_session_path, method: :patch, local: true do |f| %>

    <label>目標金額(¥)</label>
    <%= f.number_field :target_price, step: 1 %>
    <% @session.errors.full_messages_for(:target_price).each do |msg| %>
        <%= msg %>
    <% end %>

    <label>目標時間(h)</label>
    <%= f.number_field :target_hours, step: 0.5 %>
    <% @session.errors.full_messages_for(:target_hours).each do |msg| %>
        <%= msg %>
    <% end %>

  <%= f.submit "保存" %>

<% end %>

<%# --- ここからサンプル（コメントアウト） ---
<div data-controller="tiny-timer">
  <span data-tiny-timer-target="elapsed">00:00:00</span>
  <button type="button" data-action="click->tiny-timer#start">Start</button>
  <button type="button" data-action="click->tiny-timer#stop">Stop</button>
</div>
--- ここまでコメントアウト --- %>

<div
  data-controller="tiny-timer"
  data-tiny-timer-initial-seconds-value="<%= @session.live_seconds %>"
  data-tiny-timer-running-value="<%= @session.running? %>">
  <span data-tiny-timer-target="elapsed">00:00:00</span>
</div>

<%= link_to "Start",
            start_session_path,
            data: {
              turbo_method: :post,
              action: "click->tiny-timer#handleStartClick",
              tiny_tiny_timer_target: nil, # ダミー防止（無視されます）
              tiny_timer_target: "startButton"
            },
            class: "btn start" %>

<%= link_to "Stop",
            stop_session_path,
            data: {
              turbo_method: :post,
              action: "click->tiny-timer#handleStopClick",
              tiny_timer_target: "stopButton"
            },
            class: "btn stop" %>

<%= link_to "Reset",
            reset_session_path,
            data: {
                turbo_method: :post,
                turbo_confirm: "本当にリセットしますか？（合計時間が0に戻ります）",
                action: "click->tiny-timer#stop"
            },
            class: "btn reset" %>

<!-- app/views/sessions/show.html.erb の見やすい位置に追記 -->
<section class="today-summary">
  <h2>今日のサマリー</h2>
  <p>合計時間：<strong><%= format_duration(@session.today_total_seconds) %></strong></p>
  <p>市場価値（今日）： 
    <strong>
      <%= number_to_currency(@session.hour_price * (@session.today_total_seconds / 3600.0), unit: "¥", precision: 0) %>
    </strong>
  </p>
</section>
